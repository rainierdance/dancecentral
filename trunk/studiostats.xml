<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="DanceCentral.info Studio Management"
             description="DanceCentral.info Studio Management"
             author="DanceCentral.info"
             >
<Require feature="idi"/>
<Require feature="setprefs" />
<Require feature="locked-domain" />
</ModulePrefs>
<UserPref name="dataUrl" display_name="Data url"
          required="true"/>
<Content type="html"><![CDATA[
<script src="http://www.google.com/jsapi" type="text/javascript"></script>

<script>
function escapeHtml(text) {
  if (text == null) {
    return '';
  }
  //return _hesc(text);
  return text;
}

/**
 * Load the APIs and run sendStudentQuery when the load is complete
 */
var gadgetHelper = null;
_IG_RegisterOnloadHandler(loadVisualizationAPI);
function loadVisualizationAPI() {
  google.load("visualization", "1");
  google.setOnLoadCallback(sendDataQuery);
}

/**
 * Create a query (shaped by the Gadget's user preferences), then
 * send it to the spreadsheet data source. Also give the name of a
 * function ("handleQueryResponse") to run once the spreadsheet data
 * is retrieved:
 */
var prefs = new _IG_Prefs(); // User preferences

function sendDataQuery() {
  prefs.set('_table_query_url', prefs.getString('dataUrl'));
  gadgetHelper = new google.visualization.GadgetHelper();
  var query = gadgetHelper.createQueryFromPrefs(prefs);
  query.send(handleDataQueryResponse);
}

function handleDataQueryResponse(response) {
  if (!gadgetHelper.validateResponse(response)) {
    return;     // Default error handling was done, just leave.
  }
  var data = response.getDataTable();
  for (var row = 0; row < data.getNumberOfRows(); row++) {
    var cols = [];
    for (var col = 0; col < data.getNumberOfColumns(); col++) {
      cols.push(data.getFormattedValue(row,col));
    }
    gAllEntities.push(cols);
  }

  initData();
}
</script>

<body onload='onLoad()'>
<style>
td, body {
  font-family: Arial, sans-serif;
  font-size: 0.8em;
}
a:hover {text-decoration: underline; color: red; background: #fafad2;}
.errMsg {background-color: #ffe6cc; border: 2px solid #c43b1d; padding: 2px;}
</style>

<script>
var IS_GADGET = true;
var VERSION = "12.0222.1624";

////////////////////////////////////////////////////////////////////////
// Globals
// everyone who signed liability waiver, including all teachers and students
// read from data file
var gAllEntities = [];	 

// read from data file, current ongoing classes
var gAllClasses = [];

// read from data file, used to populate private lesson teacher drop down
var gAllTeachers = []; 

var gAllSignInTypes = []; // value,display pair
var gAllRateTypes = [];
var gSelectedEntity = null; // Entity object
var gSelectedSignInTypeIndex = null;
var gErrElement;

////////////////////////////////////////////////////////////////////////
<!-- Utilities -->
function formatDate(dateObj) {
  return dateObj.getFullYear() + '-' +
   ('' + (100 + dateObj.getMonth() + 1)).substring(1) + '-' +
   ('' + (100 + dateObj.getDate())).substring(1);
}


////////////////////////////////////////////////////////////////////////
function initData() {
  var html = [];
  for (var i=0; i< gAllEntities.length; i++) {
   html.push(gAllEntities[i].join(", "));
   html.push('<p>');
  }
  html.push(gAllEntities.length);
  _gel('idEntityList').innerHTML = html.join('');
}

</script> 

<!--- UI elements --->

<div id="idEntityList" style="overflow: auto;"><img src="http://www.google.com/ig/images/spinner.gif" /></div>


</body>
]]></Content>
</Module>

