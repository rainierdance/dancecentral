<body onload='onLoad()'>
<style>
td, body {
  font-family: Arial, sans-serif;
  font-size: 0.8em;
}
a:hover {text-decoration: underline; color: red; background: #fafad2;}
</style>

<script>
var IS_GADGET = false;
var VERSION = "$Rev$";

////////////////////////////////////////////////////////////////////////
// Globals

// read from data file, current ongoing classes
var gAllClasses = [];
var gAllFilters = {};

////////////////////////////////////////////////////////////////////////
<!-- Utilities -->
function formatDate(dateObj) {
  return dateObj.getFullYear() + '-' +
   ('' + (100 + dateObj.getMonth() + 1)).substring(1) + '-' +
   ('' + (100 + dateObj.getDate())).substring(1);
}

////////////////////////////////////////////////////////////////////////
// 

var resultList = null;

// filter: key: possible values (each key: or)
function filterClasses(filter) {
  if (!filter) return gAllClasses;
  var classes = [];
  for (var i = 0; i < gAllClasses.length; i++ ) {
    var match = true;
    for (var key in filter) {
     //  AND relation, if not a match, break out
     // check each filter value
     var values = filter[key];
     var len = values.length;
     var found = false;
     if (len != 0) { // if non is selected, it's match
       for (var j=0; j < len; j++) { // if found a match, true
         if (gAllClasses[i][key] == values[j]) {
           found = true;
           break;
         }
       }
     } else {
       found = true;
     }
     if (!found) {
       match = false;
       break;
     }
    }
    if (match) classes.push(gAllClasses[i]);
  }

  return classes;
}

function showClasses(filter) {
  resultList = filterClasses(filter)

  if (resultList.length == 0) {
    _gel('idEntityList').innerHTML = 'No matching classes.'
   return;
  }
    
  var html = [];
  for (var i = 0; i < resultList.length; i++) {
    html.push('<a href="javascript:void(0)" onclick="showClassDetails(' +
      i + ')" onmouseover="showClassDetails(' + i + ')">' +
      resultList[i]['title'] + '</a><br>');
  }
  _gel('idEntityList').innerHTML = html.join('');
}

function updateFilter() {
  _gel('idEntityDetails').innerHTML = ''; // clear details, as result will change

  // get filters from checkbox
  var fmFilter = _gel('fmFilter');
  var filter = {};
  for (var key in filterKeys) {
    var filterOptions = fmFilter['filterChk' + key];
    var len = filterOptions.length;
    var values = [];
    for (var i=0; i<len; i++) {
      if (filterOptions[i].checked) values.push(filterOptions[i].value);
    }
    filter[key] = values;
  }

  showClasses(filter);
}

function showClassDetails(index) {
  var groupClass = resultList[index];
  var html = [];
  html.push('<div style="font-weight:bold">' + groupClass['title'] + '</div><p>');
  html.push('Category: ' + groupClass['category'] + '<br>');
  html.push('Start date: ' + groupClass['start_date'] + ' ' +  groupClass['day_of_week'] + 
    ' ' + groupClass['start_time'] + '<br>');
  html.push('Style: ' + groupClass['style'] + ' ' + groupClass['dance_name'] + '<br>');
  html.push('Level: ' + groupClass['level'] + '<br>');
  html.push('Teacher: <a href="' + groupClass['bio'] + '" target="_blank">' + groupClass['teacher'] + '</a><p>');
  html.push(groupClass['description'] + '<br>');
  _gel('idEntityDetails').innerHTML = html.join('');
}

var filterKeys = {
  'teacher' : 'Teacher',
  'level' : 'Level' ,
  'day_of_week' : 'Day of Week',
  'style' : 'Style'
}; 

function showFilters() {
  // fill in the filters
  for (var key in filterKeys) {
   gAllFilters[key] = [];
  }

  var key;
  for (var i = 0; i < gAllClasses.length; i++) {
    for (var key in filterKeys) {
      if (gAllClasses[i][key] && (gAllFilters[key].indexOf(gAllClasses[i][key]) == -1)) {
        gAllFilters[key].push(gAllClasses[i][key]);
      }
    }
  }

  var keyNo = 0;
  var html = ['<table>'];
  for (var key in filterKeys) {
    var len = gAllFilters[key].length;
    html.push('<tr><td>' + filterKeys[key] + '</td><td>');
    for (var i = 0; i<len; i++) {
      var idLabel = 'key' + keyNo + '_' + i;
      html.push('<input type="checkbox" name="filterChk' + key + 
        '" onclick="updateFilter()" value="' + gAllFilters[key][i]+ '" id="' + idLabel + '" /><label for="' +
        idLabel + '">&nbsp;' + gAllFilters[key][i] + "</label> &nbsp; &nbsp; ");
    }
    keyNo++;
    html.push('</td></tr>');
  }
  html.push('</table>');
   _gel('filterSelection').innerHTML = html.join('');

  showClasses(); // show all clases
}

function showAllClasses() {
  // reset
  _gel('fmFilter').reset();
  _gel('idEntityDetails').innerHTML = '';

  // display all classes
  showClasses();
}

</script> 

<!--- UI elements --->

<!-- Search header, always shown -->
Classes: <a href="javascript:void(0)" onclick="showAllClasses()">show all</a><br>
<form id="fmFilter">
<div id='filterSelection'></div>
</form>

<!-- Search result list + each participant details -->
<table cellspacing=15 id='idSearchResult'>
<tr><td valign=top nowrap>
<div id="idEntityList" style="overflow: auto;"><img src="http://www.google.com/ig/images/spinner.gif" /></div>
</td>
<td valign=top> <div id='idEntityDetails'></div></td>
</tr>
</table>

<div id="idEntityHeader">
<span id="fieldName" style="font-weight:bold;font-size:1.1em;line-height:2;padding-left:20px"></span>
<div id="fieldType"></div>
</div>

<! -- Preparation form, used by UI to eventually calculate what should be posted to spreasheet  -->
<form onSubmit="return onSignIn()" id="idFormPrep">

<div id="idSignInPanel" style="display:none">
<hr style="background-color:rgb(204,204,204);border-top-style:none;border-right-style:none;border-bottom-style:none;border-left-style:none;height:1px">

<table border=0 cellspacing=5>

<tr id="trDateTime"><td width=150>Date and Time</td><td>
<input type="text" name="entry.6.single" value=""  id="entry_prep_date"> &nbsp;
<input type="text" value=""  id="startTimeHour" size=2> : 
<input type="text" value=""  id="startTimeMin" size=2> 
<!-- changed to use text box
<select id='startTimeHour'>
<option>12</option>
<option>1</option>
<option>2</option>
<option>3</option>
<option>4</option>
<option>5</option>
<option>6</option>
<option>7</option>
<option>8</option>
<option>9</option>
<option>10</option>
<option>11</option>
</select>
<select id='startTimeMin'>
<option>00</option>
<option>15</option>
<option>30</option>
<option>45</option>
</select>
!-->
<select id='startTimeAmPm'>
<option>am</option>
<option>pm</option>
</select>

</td</tr>

<tr id="trClasses"><td>Classes <a href="javascript:void(0)" onclick="fillInClasses(false)">show all</a></td><td>
<span id="fieldClasses"></span>
</td></tr>

<tr id="trTeacher"><td>Private lesson teacher</td><td>
<span id="fieldTeachers"></span>
</td></tr>

<tr id="trLength"><td>Length</td><td>
<input type="text" name="entry.6.single" value=""  id="entry_prep_length" size=3> 45-min lesson &nbsp; &nbsp; &nbsp;
<input type="text" value=""  id="entry_prep_length_hr" size=3> 1-hour lesson<br>
</td></tr>

<tr id="trRateType"><td>Rate type</td><td>
<span id="fieldRate"></span>
</td></tr>

<tr id="trPackages"><td>Series, Packages</td>
<td><span id="fieldPackage">
<table>
<tr><td><input type='text' value="" id="entry_prep_payment_num_series" size=3 onchange="updateSeriesTotal()"> Number of Group Series sessions </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_series" onchange="updateTotal()" size=3></td></tr>
<tr style="background:whitesmoke"><td><input type='text' value="" id="entry_prep_payment_num_punch" size=3  onchange="updatePunchTotal()"> Number of Punch Cards</td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_punch" onchange="updateTotal()" size=3></td></tr>
<tr><td><input type='text' value="" id="entry_prep_payment_num_private" size=3 onchange="updatePrivateTotal()"> Number of Private Lessons </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_private" onchange="updateTotal()" size=3></td></tr>
<tr style="background:whitesmoke"><td><input type='text' value="" id="entry_prep_payment_num_youth"  onchange="updateYouthTotal()" onchange="updateTotal()" size=3> Number of students in Youth Program </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_youth" onchange="updateTotal()" size=3></td></tr>
<tr><td><input type='text' value="" id="entry_prep_payment_num_child" size=3  onchange="updateChildrenTotal()"> Number of students in Children's Program </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_child" onchange="updateTotal()" size=3></td></tr>
<tr  style="background:whitesmoke"><td><input type='text' value="" id="entry_prep_payment_num_practice" size=3  onchange="updatePracticeTotal()"> Number of dancers for Monthly Practice </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_practice" onchange="updateTotal()" size=3></td></tr>
<tr><td><input type='text' value="" id="entry_prep_payment_num_floor"  onchange="updateFloorTotal()" onchange="updateTotal()" size=3> Number of lessons for Floor Fees </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_floor" onchange="updateTotal()" size=3>
</td>
</tr>
<!--
<tr style="background:whitesmoke"><td><input type='text' value="" id="entry_prep_payment_num_wedding"  onchange="updateWeddingTotal()" onchange="updateTotal()" size=3> Number of Lessons for Wedding Dance </td>
<td>Amount: <input type='text' value="" id="entry_prep_payment_amt_wedding" onchange="updateTotal()" size=3></td></tr>
-->
</table>
<p>
Specials:<br>
<input type='radio' value="Intro" name="rSpecial" id='labelSpecialIntro' onclick="onSpecial('Intro')"> <label for="labelSpecialIntro">Introductory Special</label>
&nbsp; &nbsp; &nbsp;
<input type='radio' value="Wedding" name="rSpecial" id='labelSpecialWedding' onclick="onSpecial('Wedding')"> <label for="labelSpecialWedding">Wedding Special</label>
&nbsp; &nbsp; &nbsp;
<input type='radio' value="None" name="rSpecial" id='labelSpecialNone' onclick="onSpecial('None')" checked> <label for="labelSpecialNone">None</label>
</span>
</td>
</tr>

<tr id="trPayment"><td>Total Payment</td><td>
<input type='text' value="" id="entry_prep_payment_total" size=6 readonly>&nbsp;&nbsp;
<input type='radio' value="Cash" name="rPaymentMethod" id='labelPrepMethodCash' ><label for="labelPrepMethodCash">Cash</label> &nbsp;&nbsp;
<input type='radio' value="Check" name="rPaymentMethod" id='labelPrepMethodCheck' ><label for="labelPrepMethodCheck">Check</label>&nbsp;&nbsp; 
<input type='radio' value="CreditCard" name="rPaymentMethod" id='labelPrepMethodCC' ><label for="labelPrepMethodCC">Credit Card</label><br>
Payment discount: <input type='text' value="" id="entry_prep_payment_discount" size=40>&nbsp;&nbsp;

</td></tr>

<tr><td valign=top>Note</td><td>
<textarea name="entry.5.single" rows="3" cols="50"  id="entry_prep_note"></textarea>
</td></tr>
</table>

<input type="submit" name="submit" value="Sign In">
</form>

<!-- End of preparation form>

<!-- Normally hidden, the actual form used to post to Google Spreadsheet -->
<div style="display:none">
<form target="frmSubmit" 
  action="https://docs.google.com/a/ariaballroom.com/spreadsheet/formResponse?hl=en_US&amp;formkey=dC1ScmpPZF9pWG9qQ1JraWkyMi1GZmc6MQ&amp;ifq" 
  method="POST" id="ss-form">
Name: <input type="text" name="entry.0.single" value=""  id="entry_0"><br>
Type: <input type="text" name="entry.4.single" value=""  id="entry_4"><br>
Date: <input type="text" name="entry.6.single" value=""  id="entry_6"><br>
Start time: <input type="text" name="entry.8.single" value=""  id="entry_8"><br>
Class/Party  name: <input type="text" name="entry.9.single" value=""  id="entry_9" size=160><br>
Teacher: <input type="text" name="entry.3.single" value=""  id="entry_3"><br>
Length:<input type="text" name="entry.11.single" value=""  id="entry_11"><br>
Rate type: <input type="text" name="entry.10.single" value=""  id="entry_10"><br>
Amount: <input type="text" name="entry.12.single" value=""  id="entry_12"><br>
Payment method: <input type="text" name="entry.13.single" value=""  id="entry_13"><br>
Payment discount: <input type="text" name="entry.30.single" value=""  id="entry_30"><br>
# of Group Series: <input type="text" name="entry.14.single" value=""  id="entry_14"><br>
# of Punch Card: <input type="text" name="entry.15.single" value=""  id="entry_15"><br>
# of Private Lessons: <input type="text" name="entry.16.single" value=""  id="entry_16"><br>
# of Wedding Lessons: <input type="text" name="entry.17.single" value=""  id="entry_17"><br>
# of Children's Program: <input type="text" name="entry.18.single" value=""  id="entry_18"><br>
# of Youth Program: <input type="text" name="entry.19.single" value=""  id="entry_19"><br>
# of Montly Practice: <input type="text" name="entry.20.single" value=""  id="entry_20"><br>
# of Lessons for Floore Fees: <input type="text" name="entry.21.single" value=""  id="entry_21"><br>
$ of Group Series: <input type="text" name="entry.22.single" value=""  id="entry_22"><br>
$ of Punch Card: <input type="text" name="entry.23.single" value=""  id="entry_23"><br>
$ of Private Lessons: <input type="text" name="entry.24.single" value=""  id="entry_24"><br>
$ of Wedding Lessons: <input type="text" name="entry.25.single" value=""  id="entry_25"><br>
$ of Children's Program: <input type="text" name="entry.26.single" value=""  id="entry_26"><br>
$ of Youth Program: <input type="text" name="entry.27.single" value=""  id="entry_27"><br>
$ of Montly Practice: <input type="text" name="entry.28.single" value=""  id="entry_28"><br>
$ of Lessons for Floore Fees: <input type="text" name="entry.29.single" value=""  id="entry_29"><br>
Note: <textarea name="entry.5.single" rows="8" cols="75"  id="entry_5"></textarea><br>
<input type="hidden" name="pageNumber" value="0">
<input type="hidden" name="backupCache" value="">
<input type="submit" name="submit" value="Submit" id='btnSubmit'>
</form>
</div>

<!-- Visible to make sure form post is successful -->
<div>
<iframe name="frmSubmit" id='idFrameSubmit' width=500 height=200 frameborder=0 scrolling=no></iframe>
</div>

</div>

<script type="text/javascript" SRC="localonly.js"></script>

</body>
